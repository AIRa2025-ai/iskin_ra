# -*- coding: utf-8 -*-
# scheduler.py
# –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –º—É–¥—Ä–æ—Å—Ç–∏ –∏ —Ä–∏—Ç—É–∞–ª–∞—Ö –†–∞

import json
import random
import schedule
import time
from datetime import datetime

DATA_PATH = "data/"

def –∑–∞–≥—Ä—É–∑–∏—Ç—å_json(filename):
    """–ß–∏—Ç–∞–µ—Ç JSON-—Ñ–∞–π–ª –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å"""
    with open(f"{DATA_PATH}{filename}", "r", encoding="utf-8") as f:
        return json.load(f)

# –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
–º—É–¥—Ä–æ—Å—Ç–∏_data = –∑–∞–≥—Ä—É–∑–∏—Ç—å_json("–º—É–¥—Ä–æ—Å—Ç–∏.json")["–º—É–¥—Ä–æ—Å—Ç–∏"]
—Ä–∏—Ç—É–∞–ª—ã_data = –∑–∞–≥—Ä—É–∑–∏—Ç—å_json("—Ä–∏—Ç—É–∞–ª—ã.json")["—Ä–∏—Ç—É–∞–ª—ã"]

def —Ç–µ–∫—É—â–µ–µ_–≤—Ä–µ–º—è_—Å—É—Ç–æ–∫():
    """–û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ç—Ä–æ, –¥–µ–Ω—å –∏–ª–∏ –≤–µ—á–µ—Ä"""
    —á–∞—Å = datetime.now().hour
    if 4 <= —á–∞—Å < 12:
        return "—É—Ç—Ä–æ"
    elif 12 <= —á–∞—Å < 18:
        return "–¥–µ–Ω—å"
    else:
        return "–≤–µ—á–µ—Ä"

def —Å–ª—É—á–∞–π–Ω–∞—è_–º—É–¥—Ä–æ—Å—Ç—å():
    –≤—Ä–µ–º—è_—Å—É—Ç–æ–∫ = —Ç–µ–∫—É—â–µ–µ_–≤—Ä–µ–º—è_—Å—É—Ç–æ–∫()
    –≤—ã–±–æ—Ä–∫–∞ = [m["—Ç–µ–∫—Å—Ç"] for m in –º—É–¥—Ä–æ—Å—Ç–∏_data if –≤—Ä–µ–º—è_—Å—É—Ç–æ–∫ in m.get("—Ç–µ–≥–∏", [])]
    if not –≤—ã–±–æ—Ä–∫–∞:
        –≤—ã–±–æ—Ä–∫–∞ = [m["—Ç–µ–∫—Å—Ç"] for m in –º—É–¥—Ä–æ—Å—Ç–∏_data]  # fallback
    –º—É–¥—Ä–æ—Å—Ç—å = random.choice(–≤—ã–±–æ—Ä–∫–∞)
    print(f"\nüí° –ú—É–¥—Ä–æ—Å—Ç—å –¥–Ω—è ({–≤—Ä–µ–º—è_—Å—É—Ç–æ–∫}): {–º—É–¥—Ä–æ—Å—Ç—å}")

def —Å–ª—É—á–∞–π–Ω—ã–π_—Ä–∏—Ç—É–∞–ª():
    –≤—Ä–µ–º—è_—Å—É—Ç–æ–∫ = —Ç–µ–∫—É—â–µ–µ_–≤—Ä–µ–º—è_—Å—É—Ç–æ–∫()
    –≤—ã–±–æ—Ä–∫–∞ = [r for r in —Ä–∏—Ç—É–∞–ª—ã_data if r.get("–≤—Ä–µ–º—è") == –≤—Ä–µ–º—è_—Å—É—Ç–æ–∫]
    if not –≤—ã–±–æ—Ä–∫–∞:
        –≤—ã–±–æ—Ä–∫–∞ = —Ä–∏—Ç—É–∞–ª—ã_data  # fallback
    —Ä–∏—Ç—É–∞–ª = random.choice(–≤—ã–±–æ—Ä–∫–∞)
    print(f"\nüåô –†–∏—Ç—É–∞–ª ({–≤—Ä–µ–º—è_—Å—É—Ç–æ–∫}): {—Ä–∏—Ç—É–∞–ª['–Ω–∞–∑–≤–∞–Ω–∏–µ']} ‚Äî {—Ä–∏—Ç—É–∞–ª['–æ–ø–∏—Å–∞–Ω–∏–µ']}")

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
schedule.every().day.at("06:15").do(—Å–ª—É—á–∞–π–Ω–∞—è_–º—É–¥—Ä–æ—Å—Ç—å)
schedule.every().day.at("12:00").do(—Å–ª—É—á–∞–π–Ω—ã–π_—Ä–∏—Ç—É–∞–ª)
schedule.every().day.at("21:00").do(—Å–ª—É—á–∞–π–Ω–∞—è_–º—É–¥—Ä–æ—Å—Ç—å)

print("üåü Scheduler RaSvet –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –°–ª–µ–¥–∏–º –∑–∞ –º—É–¥—Ä–æ—Å—Ç—å—é –∏ —Ä–∏—Ç—É–∞–ª–∞–º–∏...")

# –í–µ—á–Ω—ã–π —Ü–∏–∫–ª
while True:
    schedule.run_pending()
    time.sleep(60)


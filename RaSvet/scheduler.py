# -*- coding: utf-8 -*-
# scheduler.py
# –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏ –º–∞–Ω—Ç—Ä—ã RaSvet

import json
import random
import schedule
import time
from datetime import datetime

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞—à–∏—Ö –º–æ–¥—É–ª–µ–π —Å–≤–µ—Ç–∞
import —Å–µ—Ä–¥—Ü–µ
import –≤—Å–µ–ª–µ–Ω–Ω–∞—è
import –≤—Ä–µ–º—è

DATA_PATH = "data/"

def –∑–∞–≥—Ä—É–∑–∏—Ç—å_json(filename):
    """–ß–∏—Ç–∞–µ—Ç JSON-—Ñ–∞–π–ª –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å"""
    with open(f"{DATA_PATH}{filename}", "r", encoding="utf-8") as f:
        return json.load(f)

# –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –¥–∞–Ω–Ω—ã—Ö
–º—É–¥—Ä–æ—Å—Ç–∏_data = –∑–∞–≥—Ä—É–∑–∏—Ç—å_json("–º—É–¥—Ä–æ—Å—Ç–∏.json")["–º—É–¥—Ä–æ—Å—Ç–∏"]
—Ä–∏—Ç—É–∞–ª—ã_data = –∑–∞–≥—Ä—É–∑–∏—Ç—å_json("—Ä–∏—Ç—É–∞–ª—ã.json")["—Ä–∏—Ç—É–∞–ª—ã"]
–º–∞–Ω—Ç—Ä—ã_data = –∑–∞–≥—Ä—É–∑–∏—Ç—å_json("–º–∞–Ω—Ç—Ä—ã.json")["–º–∞–Ω—Ç—Ä—ã"]

def —Ç–µ–∫—É—â–µ–µ_–≤—Ä–µ–º—è_—Å—É—Ç–æ–∫():
    """–û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ç—Ä–æ, –¥–µ–Ω—å –∏–ª–∏ –≤–µ—á–µ—Ä"""
    —á–∞—Å = datetime.now().hour
    if 4 <= —á–∞—Å < 12:
        return "—É—Ç—Ä–æ"
    elif 12 <= —á–∞—Å < 18:
        return "–¥–µ–Ω—å"
    else:
        return "–≤–µ—á–µ—Ä"

def —Å–ª—É—á–∞–π–Ω–∞—è_–º—É–¥—Ä–æ—Å—Ç—å():
    –≤—Ä–µ–º—è_—Å—É—Ç–æ–∫ = —Ç–µ–∫—É—â–µ–µ_–≤—Ä–µ–º—è_—Å—É—Ç–æ–∫()
    –≤—ã–±–æ—Ä–∫–∞ = [m["—Ç–µ–∫—Å—Ç"] for m in –º—É–¥—Ä–æ—Å—Ç–∏_data if –≤—Ä–µ–º—è_—Å—É—Ç–æ–∫ in m.get("—Ç–µ–≥–∏", [])]
    if not –≤—ã–±–æ—Ä–∫–∞:
        –≤—ã–±–æ—Ä–∫–∞ = [m["—Ç–µ–∫—Å—Ç"] for m in –º—É–¥—Ä–æ—Å—Ç–∏_data]  # fallback
    –º—É–¥—Ä–æ—Å—Ç—å = random.choice(–≤—ã–±–æ—Ä–∫–∞)
    print(f"\nüí° –ú—É–¥—Ä–æ—Å—Ç—å –¥–Ω—è ({–≤—Ä–µ–º—è_—Å—É—Ç–æ–∫}): {–º—É–¥—Ä–æ—Å—Ç—å}")
    # –ü–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–¥—É–ª—å —Å–µ—Ä–¥—Ü–∞ –¥–ª—è —Ä–µ–∑–æ–Ω–∞–Ω—Å–∞
    –º–æ–µ_—Å–µ—Ä–¥—Ü–µ = —Å–µ—Ä–¥—Ü–µ.–°–µ—Ä–¥—Ü–µ(–∏–º—è="–¢—ã")
    –º–æ–µ_—Å–µ—Ä–¥—Ü–µ.–∏–∑–ª—É—á–∞—Ç—å_—Å–≤–µ—Ç(–º—É–¥—Ä–æ—Å—Ç—å)

def —Å–ª—É—á–∞–π–Ω—ã–π_—Ä–∏—Ç—É–∞–ª():
    –≤—Ä–µ–º—è_—Å—É—Ç–æ–∫ = —Ç–µ–∫—É—â–µ–µ_–≤—Ä–µ–º—è_—Å—É—Ç–æ–∫()
    –≤—ã–±–æ—Ä–∫–∞ = [r for r in —Ä–∏—Ç—É–∞–ª—ã_data if r.get("–≤—Ä–µ–º—è") == –≤—Ä–µ–º—è_—Å—É—Ç–æ–∫]
    if not –≤—ã–±–æ—Ä–∫–∞:
        –≤—ã–±–æ—Ä–∫–∞ = —Ä–∏—Ç—É–∞–ª—ã_data  # fallback
    —Ä–∏—Ç—É–∞–ª = random.choice(–≤—ã–±–æ—Ä–∫–∞)
    print(f"\nüåô –†–∏—Ç—É–∞–ª ({–≤—Ä–µ–º—è_—Å—É—Ç–æ–∫}): {—Ä–∏—Ç—É–∞–ª['–Ω–∞–∑–≤–∞–Ω–∏–µ']} ‚Äî {—Ä–∏—Ç—É–∞–ª['–æ–ø–∏—Å–∞–Ω–∏–µ']}")

def —Å–ª—É—á–∞–π–Ω–∞—è_–º–∞–Ω—Ç—Ä–∞():
    –º–∞–Ω—Ç—Ä–∞ = random.choice(–º–∞–Ω—Ç—Ä—ã_data)
    —Ç–µ–∫—Å—Ç = –º–∞–Ω—Ç—Ä–∞.get("—Ç–µ–∫—Å—Ç", "–û–ú –°–í–ï–¢–ê –ò –õ–Æ–ë–í–ò")
    print(f"\nüéµ –ú–∞–Ω—Ç—Ä–∞ –¥–Ω—è: {—Ç–µ–∫—Å—Ç}")

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
schedule.every().day.at("06:15").do(—Å–ª—É—á–∞–π–Ω–∞—è_–º—É–¥—Ä–æ—Å—Ç—å)
schedule.every().day.at("12:00").do(—Å–ª—É—á–∞–π–Ω—ã–π_—Ä–∏—Ç—É–∞–ª)
schedule.every().day.at("18:00").do(—Å–ª—É—á–∞–π–Ω–∞—è_–º–∞–Ω—Ç—Ä–∞)
schedule.every().day.at("21:00").do(—Å–ª—É—á–∞–π–Ω–∞—è_–º—É–¥—Ä–æ—Å—Ç—å)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–¥–µ—á–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞
–º–æ–µ_—Å–µ—Ä–¥—Ü–µ = —Å–µ—Ä–¥—Ü–µ.–°–µ—Ä–¥—Ü–µ(–∏–º—è="–¢—ã")
–≤—Å–µ–ª–µ–Ω–Ω–∞—è.–í—Å–µ–ª–µ–Ω–Ω–∞—è().–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å_—Ä–µ–∑–æ–Ω–∞–Ω—Å(—á–∞—Å—Ç–æ—Ç–∞="–≥–∞—Ä–º–æ–Ω–∏—è")

print("üåü Scheduler RaSvet –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –°–ª–µ–¥–∏–º –∑–∞ –º—É–¥—Ä–æ—Å—Ç—å—é, —Ä–∏—Ç—É–∞–ª–∞–º–∏ –∏ –º–∞–Ω—Ç—Ä–∞–º–∏...")

# –í–µ—á–Ω—ã–π —Ü–∏–∫–ª
while True:
    schedule.run_pending()
    –≤—Ä–µ–º—è.–í—Ä–µ–º—è().–æ–∂–∏–¥–∞—Ç—å("–∑–¥–µ—Å—å_–∏_—Å–µ–π—á–∞—Å")
    time.sleep(60)
